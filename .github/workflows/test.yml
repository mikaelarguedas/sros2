name: Test sros2
on:
  pull_request:
  push:
  schedule:
    # Run daily
    - cron:  '0 12 * * *'

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        env:
        - {JOB_TYPE: nightly}
        - {JOB_TYPE: nightly, COLCON_EXTRA_CMAKE_ARGS: "-DSECURITY=ON", MIXINS_BUILD: "release", COLCON_EXTRA_PYTEST_ARGS: "--cov-report=term", COLCON_TEST_EXTRA_ARGS: "--pytest-with-coverage"}
        # - {JOB_TYPE: eloquent}
    steps:
    - uses: actions/checkout@v1
    - name: build and test
      run: |
            cd ${GITHUB_WORKSPACE}
            git clone --quiet --depth 1 https://github.com/mikaelarguedas/ros2ci.git -b actions_support .ros2ci
            .ros2ci/top_level_ci.bash $JOB_TYPE
      env: ${{matrix.env}}
    # - name: Upload coverage to Codecov
    #   uses: codecov/codecov-action@v1.0.6
    #   if: github.event_name == 'pull_request' || (github.event_name == 'push' && github.ref == 'refs/heads/master')
    #   with:
    #     file: ros_ws/src/sros2/sros2/coverage.xml
    #     flags: unittests
    #     name: sros2-coverage
    #     fail_ci_if_error: true
    #     yml: .codecov.yml
    # - name: Upload Logs
    #   uses: actions/upload-artifact@v1
    #   if: failure()
    #   with:
    #     name: colcon-logs
    #     path: ros_ws/log
